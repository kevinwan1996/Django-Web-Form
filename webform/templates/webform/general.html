{% extends 'webform/base.html' %}
{% load staticfiles %}

{% block content %}
	<style>
		input {
			width: 60%;
			padding: 1px 1px;
			margin: 0px 0;
			border: 1px solid #ccc;
		}
	</style>

  	<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.5.0/jquery.min.js"></script>

	<script type="text/javascript">
	$(document).ready(function() {
	  // Code adapted from http://djangosnippets.org/snippets/1389/
	  function updateElementIndex(el, prefix, ndx) {
	    var id_regex = new RegExp('(' + prefix + '-\\d+-)');
	    var replacement = prefix + '-' + ndx + '-';
	    if ($(el).attr("for")) $(el).attr("for", $(el).attr("for").replace(id_regex,
	 replacement));
	    if (el.id) el.id = el.id.replace(id_regex, replacement);
	    if (el.name) el.name = el.name.replace(id_regex, replacement);
	  }

	  //Figure out why the parameter doesn't work... for now delete/add for Rec/Risk and both Modules
	  //Recommendation Delete and Add
	  function deleteFormRec(btn, prefix) {
	    var formCount = parseInt($('#id_' + prefix + '-TOTAL_FORMS').val());
	    if (formCount > 1) {
	      // Delete the item/form
	      $(btn).parents('.rec').remove();
	      var forms = $('.rec'); // Get all the forms
	      // Update the total number of forms (1 less than before)
	      $('#id_' + prefix + '-TOTAL_FORMS').val(forms.length);
	      var i = 0;
	      // Go through the forms and set their indices, names and IDs
	      for (formCount = forms.length; i < formCount; i++) {
	        $(forms.get(i)).children().children().each(function() {
	          updateElementIndex(this, prefix, i);
	        });
	      }
	    } // End if
	    else {
	        alert("You have to enter at least one item!");
	    }
	    return false;
	  }
	  function addFormRec(btn, prefix) {
	    var formCount = parseInt($('#id_' + prefix + '-TOTAL_FORMS').val());
	    // You can only submit a maximum of 10 todo items 
	    if (formCount < 10) {
	      // Clone a form (without event handlers) from the first form
	      var row = $(".rec:first").clone(false).get(0);
	      // Insert it after the last form
	      $(row).removeAttr('id').hide().insertAfter(".rec:last").slideDown(300);
	      
	      // Remove the bits we don't want in the new row/form
	      // e.g. error messages
	      $(".errorlist", row).remove();
	      $(row).children().removeClass('error');
	      
	      // Relabel/rename all the relevant bits
	      $(row).children().children().each(function() {
	        updateElementIndex(this, prefix, formCount);
	        if ( $(this).attr('type') == 'text' )
	          $(this).val('');
	      });
	      
	      // Add an event handler for the delete item/form link 
	      $(row).find('.delete-rec').click(function() {
	        return deleteFormRec(this, prefix);
	      });
	      // Update the total form count
	      $('#id_' + prefix + '-TOTAL_FORMS').val(formCount + 1); 
	    } // End if
	    else {
	      alert("Sorry, you can only enter a maximum of ten items.");
	    }
	    return false;
	  }
	function deleteFormRisk(btn, prefix) {
	    var formCount = parseInt($('#id_' + prefix + '-TOTAL_FORMS').val());
	    if (formCount > 1) {
	      // Delete the item/form
	      $(btn).parents('.risk').remove();
	      var forms = $('.risk'); // Get all the forms
	      // Update the total number of forms (1 less than before)
	      $('#id_' + prefix + '-TOTAL_FORMS').val(forms.length);
	      var i = 0;
	      // Go through the forms and set their indices, names and IDs
	      for (formCount = forms.length; i < formCount; i++) {
	        $(forms.get(i)).children().children().each(function() {
	          updateElementIndex(this, prefix, i);
	        });
	      }
	    } // End if
	    else {
	        alert("You have to enter at least one item!");
	    }
	    return false;
	  }
	  function addFormRisk(btn, prefix) {
	    var formCount = parseInt($('#id_' + prefix + '-TOTAL_FORMS').val());
	    // You can only submit a maximum of 10 todo items 
	    if (formCount < 10) {
	      // Clone a form (without event handlers) from the first form
	      var row = $(".risk:first").clone(false).get(0);
	      // Insert it after the last form
	      $(row).removeAttr('id').hide().insertAfter(".risk:last").slideDown(300);
	      
	      // Remove the bits we don't want in the new row/form
	      // e.g. error messages
	      $(".errorlist", row).remove();
	      $(row).children().removeClass('error');
	      
	      // Relabel/rename all the relevant bits
	      $(row).children().children().each(function() {
	        updateElementIndex(this, prefix, formCount);
	        if ( $(this).attr('type') == 'text' )
	          $(this).val('');
	      });
	      
	      // Add an event handler for the delete item/form link 
	      $(row).find('.delete-risk').click(function() {
	        return deleteFormRisk(this, prefix);
	      });
	      // Update the total form count
	      $('#id_' + prefix + '-TOTAL_FORMS').val(formCount + 1); 
	    } // End if
	    else {
	      alert("Sorry, you can only enter a maximum of ten items.");
	    }
	    return false;
	  }
	function deleteFormLC2(btn, prefix) {
	    var formCount = parseInt($('#id_' + prefix + '-TOTAL_FORMS').val());
	    if (formCount > 1) {
	      // Delete the item/form
	      $(btn).parents('.lc2').remove();
	      var forms = $('.lc2'); // Get all the forms
	      // Update the total number of forms (1 less than before)
	      $('#id_' + prefix + '-TOTAL_FORMS').val(forms.length);
	      var i = 0;
	      // Go through the forms and set their indices, names and IDs
	      for (formCount = forms.length; i < formCount; i++) {
	        $(forms.get(i)).children().children().each(function() {
	          updateElementIndex(this, prefix, i);
	        });
	      }
	    } // End if
	    else {
	        alert("You have to enter at least one item!");
	    }
	    return false;
	  }
	  function addFormLC2(btn, prefix) {
	    var formCount = parseInt($('#id_' + prefix + '-TOTAL_FORMS').val());
	    // You can only submit a maximum of 10 todo items 
	    if (formCount < 10) {
	      // Clone a form (without event handlers) from the first form
	      var row = $(".lc2:first").clone(false).get(0);
	      // Insert it after the last form
	      $(row).removeAttr('id').hide().insertAfter(".lc2:last").slideDown(300);
	      
	      // Remove the bits we don't want in the new row/form
	      // e.g. error messages
	      $(".errorlist", row).remove();
	      $(row).children().removeClass('error');
	      
	      // Relabel/rename all the relevant bits
	      $(row).children().children().each(function() {
	        updateElementIndex(this, prefix, formCount);
	        if ( $(this).attr('type') == 'text' )
	          $(this).val('');
	      });
	      
	      // Add an event handler for the delete item/form link 
	      $(row).find('.delete-lc2').click(function() {
	        return deleteFormLC2(this, prefix);
	      });
	      // Update the total form count
	      $('#id_' + prefix + '-TOTAL_FORMS').val(formCount + 1); 
	    } // End if
	    else {
	      alert("Sorry, you can only enter a maximum of ten items.");
	    }
	    return false;
	  }
	function deleteFormLC(btn, prefix) {
	    var formCount = parseInt($('#id_' + prefix + '-TOTAL_FORMS').val());
	    if (formCount > 1) {
	      // Delete the item/form
	      $(btn).parents('.lc').remove();
	      var forms = $('.lc'); // Get all the forms
	      // Update the total number of forms (1 less than before)
	      $('#id_' + prefix + '-TOTAL_FORMS').val(forms.length);
	      var i = 0;
	      // Go through the forms and set their indices, names and IDs
	      for (formCount = forms.length; i < formCount; i++) {
	        $(forms.get(i)).children().children().each(function() {
	          updateElementIndex(this, prefix, i);
	        });
	      }
	    } // End if
	    else {
	        alert("You have to enter at least one item!");
	    }
	    return false;
	  }
	  function addFormLC(btn, prefix) {
	    var formCount = parseInt($('#id_' + prefix + '-TOTAL_FORMS').val());
	    // You can only submit a maximum of 10 todo items 
	    if (formCount < 10) {
	      // Clone a form (without event handlers) from the first form
	      var row = $(".lc:first").clone(false).get(0);
	      // Insert it after the last form
	      $(row).removeAttr('id').hide().insertAfter(".lc:last").slideDown(300);
	      
	      // Remove the bits we don't want in the new row/form
	      // e.g. error messages
	      $(".errorlist", row).remove();
	      $(row).children().removeClass('error');
	      
	      // Relabel/rename all the relevant bits
	      $(row).children().children().each(function() {
	        updateElementIndex(this, prefix, formCount);
	        if ( $(this).attr('type') == 'text' )
	          $(this).val('');
	      });
	      
	      // Add an event handler for the delete item/form link 
	      $(row).find('.delete-lc').click(function() {
	        return deleteFormLC(this, prefix);
	      });
	      // Update the total form count
	      $('#id_' + prefix + '-TOTAL_FORMS').val(formCount + 1); 
	      alert($('#id_' + prefix + '-TOTAL_FORMS').val());
	    } // End if
	    else {
	      alert("Sorry, you can only enter a maximum of ten items.");
	    }
	    return false;
	  }
	  // Register the click event handlers
	  //event handlers for recommendations
	  $("#add-rec").click(function() {
	    return addFormRec(this, 'rec',);
	  });
	  
	  $(".delete-rec").click(function() {
	    return deleteFormRec(this, 'rec');
	  });
	  //event handlers for risk
	  $("#add-risk").click(function() {
	    return addFormRisk(this, 'risk');
	  });
	  $(".delete-risk").click(function() {
	    return deleteFormRisk(this, 'risk');
	  });
	  $("#add-lc2").click(function() {
	    return addFormLC2(this, 'lc2');
	  });
	  $(".delete-lc2").click(function() {
	    return deleteFormLC2(this, 'lc2');
	  });
	  $("#add-lc").click(function() {
	    return addFormLC(this, 'lc');
	  });
	  $(".delete-lc").click(function() {
	    return deleteFormLC(this, 'lc');
	  });
	});
	</script>

	<div class="general-header" style="background-color: #39CCCC;">
		<h2>General Information</h2>
	</div>
	<div class="instruction">
		<p> <strong>Instruction: </strong> This section includes the general information for the progress report. <strong> IV&V Contractor </strong> to enter state name, project name, program name (select from the drop down menu), and provide progress report date. Also include POC info for State, and submitter of this report. Also provide dates for initial consult, IV&V RFP, IV&V on-board, and next progress report. Please enter all dates in the format MM-DD-YY </p>
	</div>
	<form method="post">
		{% csrf_token %}
	    <div class="general-form">
		    <div class="column-one" style="width: 300px; height:260px; border: 1px solid green;">
		   		<p> {{ state_form.state_name.label_tag }}<br> 
		    		{{ state_form.state_name }}
				</p>
				<p> {{ ivv_form.project_name.label_tag}}<br>
		    		{{ ivv_form.project_name}}
		  		</p>
		   		<p> {{ ivv_form.program_name.label_tag}}<br>
		   			{{ ivv_form.program_name}}
			   	</p>
			   	<p> {{ ivv_form.progress_report_date.label_tag}}<br>
					{{ ivv_form.progress_report_date}}
		    	</p>
	    	</div>
		    	<div class="column-two" style="width: 300px; height:260px; border: 1px solid green;">
		    	<p> {{state_form.POC_name.label_tag }}<br>
		    		{{state_form.POC_name}}
		   		</p>
		   		<p> {{state_form.POC_email.label_tag}}<br>
		   			{{state_form.POC_email}}
		   		</p>
	    		<p> {{submitter_form.submitter_name.label_tag}}<br>
	    			{{submitter_form.submitter_name}}
		    	</p>
		    	<p> {{submitter_form.submitter_title.label_tag}}<br>
		   			{{submitter_form.submitter_title}}
		   		</p>
		   	</div>
		   	<div class="column-three" style="width: 300px; height:260px; border: 1px solid green;">
	    		<p> {{submitter_form.submitter_email.label_tag}}<br>
	    			{{submitter_form.submitter_email}}
		    	</p>
		    	<p> {{submitter_form.submitter_phone.label_tag}}<br>
		   			{{submitter_form.submitter_phone}}
		   		</p>
		   		<p> {{ivv_form.activity_one_consult_date.label_tag}}<br>
		   			{{ivv_form.activity_one_consult_date}}
	    		</p>
	    		<p> {{ivv_form.target_RFP_release_date.label_tag}}<br>
		    		{{ivv_form.target_RFP_release_date}}
		    	</p>
		    </div>
		   	<div class="column-four" style="width: 300px; height:260px; border: 1px solid green;">
		   		<p> {{ivv_form.target_IVV_on_board_date.label_tag}}<br>
		   			{{ivv_form.target_IVV_on_board_date}}
		   		</p>
	    		<p> {{ivv_form.next_progress_report_date.label_tag}}<br>
	    			{{ivv_form.next_progress_report_date}}
		    	</p>
		    </div>
		</div>
		<br><br><br><br><br><br><br><br><br><br><br><br><br>
		<div class="exec-summary-header" style="background-color: #39CCCC">
			<h2> Executive Summary </h2>
		</div>
		<div class="instruction">
			<p> <strong> Instruction: </strong> Summarize the state's status and its progress below </p>
		</div>
		<div class="exec-summary" style="padding-left:10px; padding-bottom: 20px;">
			<p>{{ivv_form.executive_summary.label_tag}}<br>
			{{ivv_form.executive_summary}} </p>
		</div>
		<div class="proj-manage-header" style="background-color: #39CCCC">
			<h2> Project Management Office Status </h2>
		</div>
		<div class="instruction">
			<p><strong>Instruction: </strong> Provide budgetary and schedule measurements below (either earned value or some other industry-accepted metrics). Variances are calculated against the budget and schedule in approved IAPD. If the IAPD has not yet been approved, enter N/A. Please enter all dates in the format MM-DD-YY </p>
		</div>
		<div class="general-form">
			<div class="column-one" style="width: 300px; height:260px; border: 1px solid green;">
				<p> {{ivv_form.total_budget.label_tag}}<br>
				{{ivv_form.total_budget}}
				</p>
				<p>	{{ivv_form.other.label_tag}}<br>
				{{ivv_form.other}}
				</p>
			</div>
			<div class="column-two" style="width: 300px; height:260px; border: 1px solid green;">
				<p> {{ivv_form.earned_value.label_tag}}<br>
				{{ivv_form.earned_value}}
				</p>
			</div>
			<div class="column-three" style="width: 300px; height:260px; border: 1px solid green;">
				<p> {{ivv_form.budget_variance.label_tag}}<br>
				{{ivv_form.budget_variance}}
				</p>
			</div>
			<div class="column-four" style="width: 300px; height:260px; border: 1px solid green;">
				<p> {{ivv_form.schedule_variance.label_tag}}<br>
				{{ivv_form.schedule_variance}}
				</p>
			</div>
		</div>
		<br><br><br><br><br><br><br><br><br><br><br><br><br>
		<div class="life-cycle-header" style="background-color: #39CCCC">
			<h2> Life Cycle Status and Schedule </h2>
		</div>
		<div class="instruction">
			<p> <strong> Instructions: </strong> For the Life Cycle Status column, use the drop down menu to indicate what milestone review was last <strong> completed </strong> for each module that is, or will be developed. (If a particular legacy module has been certified in the past and there are no plans to update it, choose R3 completed. If a state is transitioning into the MECL between R1 and R2 and its Regional Office has stated that no R1 will be necessary, then mark R1 complete and indicate N/A for the R1 date.) For the other columns, enter the anticipated dates for each milestone. Do not enter a date range. After a milestone review has actually occured, update teh entry to show the last date of the milestone review meeting and be sure to update the Life Cycle Status column. Please enter all dates in the format MM-DD-YY </p>
		</div>
		<h3 style="padding-left:15px;"> MITA Business Aligned Modules </h3>
		<div id="lc-div" style="padding-left:15px;">
			{{ lc_formset.management_form }}
				{% for form in lc_formset.forms %}
				<div class="lc">
<!-- 	can't seem to use formsets w a table..
					<table id ="lc-table" style="width: 100%">
						<tr>
							{% for field in form %} 
								{% if field.help_text %}
									<p> {{ field.help_text }}
								{% endif %}
								<th> {{ field.label_tag }} </th>
							{% endfor %}
						</tr>
						<tr id="lc-row">
							{% for field in form %} 
								<td> {{ field }} </td>
								{% for error in field.errors %}
								<p style="color: red"> {{ error }} </p>
								{% endfor %}
							{% endfor %}
						</tr>

						<p style=""><a class="delete-lc" href="/">Delete</a></p>
					</table> -->
					{{ form.as_p}}
					<p style=""><a class="delete-lc" href="/">Delete</a></p>
				</div>
				{% endfor %}
				<input id="add-lc" type="button" class="btn btn-primary" value="Add Another Module" />
		</div>
		<h3 style="padding-left:15px;"> MMIS Functional Modules </h3>
		<div id="lc2-div" style="padding-left:15px;">
			{{ lc_formset2.management_form }}
				{% for form in lc_formset2.forms %}
				<div class='lc2'>
				<!-- <div class="lc2">
					<table id ="lc2-table" style="width: 100%">
						<tr>
							{% for field in form %} 
								<th> {{ field.label_tag }} </th>
							{% endfor %}
						</tr>
						<tr id="lc2-row">
							{% for field in form %} 
								<td> {{ field }} </td>
							{% endfor %}
						</tr>
						{% for error in field.errors %}
				          	<p style="color: red">{{ error }}</p>
				        	{% endfor %}
						<p style=""><a class="delete-lc2" href="/">Delete</a></p>
					</table>
				</div> -->
					{{ form.as_p}}
					<p style=""><a class="delete-lc2" href="/">Delete</a></p>
				</div>			
				{% endfor %}
				<input id="add-lc2" type="button" class="btn btn-primary" value="Add Another Module" />
		</div>
		<div class="risk-header" style="background-color: #39CCCC">
			<h2> Risks </h2>
		</div>
		<div class="instruction">
			<p> <strong> Instructions: </strong> List important risks. These include any programmatic risks or technical risks arising from IV&V contractor's review of checklists and evidence. Add rows if necessary. Use unique Risk ID, and provide risk title and description. Pick appropriate value from probability and impact drop down choices. Based on your seleciton, risk score will be calculated automatically. Provide resolution date and plan for mitigation (include details) for this risk. Please enter all dates in the format MM-DD-YY </p>
		</div>
		<div id="risk-div" style="padding-left:15px;">
			{{ risk_formset.management_form }}
				{% for form in risk_formset.forms %}
				<div class="risk">
					<!-- table id="risk-table" style="width: 100%">
						<tr>
							{% for field in form %}
								<th> {{field.label_tag}} </th>
							{% endfor %}
						</tr>
						<tr id="risk-row">
							{% for field in form %}
								<td> {{field}} </td>
							{% endfor %}
						</tr>
						{% for error in field.errors %}
				          	<p style="color: red">{{ error }}</p>
				        	{% endfor %}
					<p style=""><a class="delete-risk" href="/">Delete</a></p>
					</table> -->
					{{form.as_p}}
					<p style=""><a class="delete-risk" href="/">Delete</a></p>
				</div>
				<input id="add-risk" type="button" class="btn btn-primary"  value="Add Another Risk" />
				{% endfor %}

		</div>
		<div class="rec-header" style="background-color: #39CCCC">
			<h2> Recommendations </h2>
		</div>
		<div class="instruction">
			<p> <strong> Instructions: </strong> List any recommendations for the state. These include any programmatic recommendations or technical recommendations arising from IV&V contractor's review of checklists and evidence. Add rows if necessary. Please enter all dates in the format MM-DD-YY</p>
		</div>
		<div id="rec-div" style="padding-left:15px;">
			{{ rec_formset.management_form }}
				{% for form in rec_formset.forms %}
				<div class="rec" style=" padding-top: 15px">
					<!-- <table id="rec-table" style="width: 100%">
					<tr>
						{% for field in form %}
							<th> {{field.label_tag}} </th>
						{% endfor %}
					</tr>
					<tr>
						{% for field in form %}
							<td> {{field}} </td>
						{% endfor %}
					</tr> -->
 				<!-- </table> -->
 					{{form.as_p}}
 					<p style=""><a class="delete-form" href="/">Delete</a></p>
				</div>
				<!-- {{ form.as_p }} -->
				<input id="add-rec" type="button" class="btn btn-primary" value ="Add Another Recommendation" />
				{% endfor %}
			
		</div>		
		<br>	
		<div id="submit" align="center">
			<button class="btn btn-primary" type="submit">Submit</button>
		</div>
	</form>


{% endblock %}